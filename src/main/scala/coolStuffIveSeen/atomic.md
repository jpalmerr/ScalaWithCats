atomic:

it either doesn't evaluate at all (e.g. if the current fiber is canceled prior to any of this even happening),
or it fully evaluates